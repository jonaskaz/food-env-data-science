---
title: "Food Environmental Predictors of County Level Diabetes Rates"
author: "Jonas Kazlauskas and Shawn Albertson"
date: "12/15/2020"
output:
  github_document:
    toc: true
---
## Introduction  

*talk about uncertainty in the data itself here?*
This dataset we used for our analysis is the Food Environment Atlas, taken from the USDA Economic Research Service. This datatset contains information on a number of food related environmental factors such as proximity to stores, food prices, food assistance programs, local food availability. It also includes data on factors that may be related to these such as obesity rate, diabetes rate, and physical activity. This data is provided on the country level across the United States. The purpose of the food environment atlas is to foster research in these areas, and give an overview of food access and health.

The data for the Food Environment Atlas is largely taken from CDC estimates. The CDC uses data from the Behavioral Risk Factor Surveillance System which is under the US Census Bureau to make estimates. 


Diabetes rate in this dataset is defined as the rate (percent) of persons over 20 years old with a BMI over 30 within each county. We compared this rate at the county level between other factors in this dataset such as proximity to grocery stores, food insecurity, socioeconomic factors and more to determine the best predictors.

Background Research:
Obesity:
Defined as everyone above 20 years old with a BMI over 30. 
Data comes from the CDC and the CDC made their estimates using data from the Behavioral Risk Factor Surveillance System which is under the US Census Bureau

Diabetes:
Estimates for people over 20 with diabetes
Data comes from the CDC and the CDC made their estimates using data from the Behavioral Risk Factor Surveillance System which is under the US Census Bureau

## Our question
We set out to answer the question:  What are the best predictors of adult diabetes rate in the US?

## Initial EDA

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library("readxl")
library(glmnet)
```

```{r load data}
path <- "data/FoodEnvironmentAtlas.xls"
# Create a list of dataframes from every sheet in the .xls file
full_list <- path %>%
  excel_sheets() %>%
  set_names() %>%
  map(read_excel, path = path)

# Create a modified list of the dataframes to only include ones with `FIPS` columns
fips_list <- full_list[c(3, 5:length(full_list))]

# Create a single dataframe with all parameters for all counties
df_all <- 
  part_list %>% 
  reduce(inner_join, by = "FIPS")
```

The most obvious thing to notice from this EDA is the fact that this dataset includes a lot of different statistics. Specifically, there are 311 statistics reported for 3140 FIPS codes. Because we are going to be investigating diabetes rates, we looked at some summary statistics for the factor `PCT_DIABETES_ADULTS08`. We can see that the mean diabetes rate is about 9.9%, which is close but slightly under the CDC's estimate of 10.2% for the national diabetes rate [6]. A histogram allows us to visualize the distribution that diabetes rates takes across all counties. We can see that the distribution looks roughly normal, but the peak is slightly shifted to the left of where we would otherwise expect the center. Interestingly, the bin at 17% appears to be *slightly* higher than the surrounding bins. What's even more interesting is that when we isolate the counties with the 10 highest diabetes rates, we find that they are all in Alabama or Georgia, with 8/10 being in Alabama. 

```{r EDA}
df_all %>% 
  dim()

df_all %>%
  select(PCT_DIABETES_ADULTS08) %>% 
  summary()

df_all %>% 
  select(c("County.x", "State.x", "PCT_DIABETES_ADULTS08")) %>% 
  arrange(desc(PCT_DIABETES_ADULTS08)) %>% 
  head(10)

df_all %>%
  select(PCT_DIABETES_ADULTS08) %>% 
  ggplot() +
  geom_histogram(aes(x = PCT_DIABETES_ADULTS08), binwidth = .5, boundary = 10) +
  xlab("Percent of Adults Diagnosed with Diabetes")
```
```{r}
df_all
```


## Methodology - Shawn
*some stuff about Lasso regression*

## What are the best predictors? - Shawn
*what they are, why that might be the case*

## How good is this model for predicting diabetes rates? 
*MSE or Rsquared values*- Shawn
*confidence interval (CI or PI?? (probably CI)) of lasso model* - Jonas
*CI for the lambda itself(?)* - Shawn

## Plots - Jonas
*maybe here, maybe scattered throughout*

## Uncertainty
*address sources of uncertainty which are potentially outside the scope of what's already been discussed*

## Conclusion - Shawn



## Sources
[1] https://www.ers.usda.gov/data-products/food-environment-atlas/data-access-and-documentation-downloads/#Current%20Version  
[2] https://www.ers.usda.gov/webdocs/DataFiles/80526/2017%20Food%20Environment%20Atlas%20Documentation.pdf?v=1143.5  
[3] https://rstatisticsblog.com/data-science-in-action/machine-learning/lasso-regression/  
[4] https://www.steveklosterman.com/over-under/  
[5] http://www.science.smith.edu/~jcrouser/SDS293/labs/lab10-r.html  
[6] https://www.cdc.gov/diabetes/pdfs/data/statistics/national-diabetes-statistics-report.pdf




